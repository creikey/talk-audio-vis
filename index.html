<html>
<head>

<style>
/* this stuff is just to make the canvas fullscreen */


* { margin:0; padding:0; } /* to remove the top and left whitespace */

html, body { width:100%; height:100%; } /* just to be sure these are full screen*/

canvas { display:block; } /* To remove the scrollbars */

button { width: 10em; height: 10%; font-size: 200%; }

#button-div {
	display: flex;
	align-items: center;
	justify-content: center;
	text-align: center;
	width: 100%;
	height: 100%;
	position: absolute;
}

</style>

</head>

<body>
	<div id="button-div">
		<button onclick="start()">Start</button>
	</div>
	<canvas id="canvas" style="display: none;">
	</canvas>

	<script>

var canvas = document.getElementById("canvas");
var button_div = document.getElementById("button-div");


function start() {
	button_div.style.display = "none";
	canvas.style.display = "block";
	const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
	const analyser = audioCtx.createAnalyser();
	analyser.fftSize = 2048;
	const bufferLength = analyser.frequencyBinCount;
	const dataArray = new Uint8Array(bufferLength);
	analyser.getByteTimeDomainData(dataArray);

	navigator.mediaDevices.getUserMedia({ audio: true })
		.then(stream => {
			// Store the media stream
			mediaStream = stream;

			// Create a media stream source node
			const source = audioCtx.createMediaStreamSource(stream);
			source.connect(analyser);

		})
		.catch(error => {
			console.error('Error accessing microphone:', error);
		});
}

function resizeCanvas() {
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;
}

window.addEventListener('resize', resizeCanvas, false);
resizeCanvas();

function draw() {

	var width = canvas.width;
	var height = canvas.height;
	var ctx = canvas.getContext("2d");

	ctx.clearRect(0, 0, width, height);

	ctx.beginPath();
	ctx.arc(width/2.0, height/2.0, width*0.1, 0, 2 * Math.PI);
	ctx.stroke();


	window.requestAnimationFrame(draw);
}
window.requestAnimationFrame(draw);


	</script>
</body>
</html>
